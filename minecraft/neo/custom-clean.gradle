// https://github.com/neoforged/NeoGradle/issues/18
tasks.register('customClean', Delete) {
    doLast {
        def files = []
        fileTree("build")
            .exclude('**/expanded.lock')
            .visit { FileVisitDetails fvd ->
                files << fvd.file
            }
        files.reverse()
            .each { f ->
                def file = file(f)
                if (!file.exists()) return;
                if ((file.isDirectory() && file.list().size() == 0)
                    || !file.isDirectory())
                    delete f
            }
    }
}
clean.dependsOn customClean
clean.enabled = false
